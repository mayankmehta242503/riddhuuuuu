document.addEventListener("DOMContentLoaded", () => {
    const book = document.getElementById("book");
    let firstPage = null;
    let lastPage = null;
    let currentPage = null;
    let startX = 0; // For mobile swiping

    const chapterData = {
       "The First Chapter Of US":`<p><p>A random boy was on his way to school, traveling by bus. He wasn't a day scholar, he was actually a hosteller. However, during the COVID period, the hostel had been shut down, forcing him to commute by bus like the other students.</p>

<p>He always sat in the last seat of the bus, accompanied by his mischievous friends, but he was the true BULLY among them.</p>

<p>One day, as the bus rolled along, they noticed a new girl, she was a junior, just starting at the school. She appeared innocent, unaware of the attention she was about to receive. With a smirk, the bully shouted his friend's name loudly, deliberately drawing her attention. The tension in the air was palpable, but the moment was short-lived as the bus neared the school. Classes proceeded as usual, with no sign of the earlier incident. When school ended and the bus made its final stop, the bully's friends got off, their station arriving just as the day came to an end.</p>

<p><strong>Wait !!!!</strong></p>

<p>She turned around, startled, and asked, ‚ÄúWere you talking to me?‚Äù The question took him by surprise, and for a brief moment, he was caught off guard, struggling to find the right words. He stammered, unable to reply as confidently as he had intended.</p>

<p>To his surprise, the girl didn't seem intimidated. Instead, she got up and moved to sit in the seat right in front of him. They exchanged some words sharp and direct and the bully found himself out of words, unable to keep up with her sharp replies. The tension was thick, mixing with curiosity, until her stop arrived. But soon enough, her stop arrived. She got off the bus, leaving him sitting there, still processing the unexpected encounter.</p>

<p>In that moment, as her confident replies left him speechless, it was clear, the tables had turned, and he found himself in an unfamiliar position, unsure of how to respond.</p>

<p>The next day, as the bus emptied and his friends got off at their stops, she unexpectedly came over and sat near him. This time, she initiated a small talk light and casual, yet enough to break the silence lingering from the day before. It wasn't friendship, not yet, but something a little less than that, a subtle connection that neither of them could put into words.</p>

<p>For two or three days, this routine continued. She would come near him, they would exchange a few casual words, and that was it‚Äînothing more, nothing less. Then, one day, as she stepped off the bus, he casually said, "Bye." It wasn't significant or sentimental, just a simple farewell.</p>

<p>That turned out to be their last meeting. After that day, they never saw each other again not on the bus, not in the school. It was his final year, and she was just a junior. Their brief interactions faded into obscurity, leaving no lasting mark. It was as if those moments had never happened, like two passing shadows that barely acknowledged each other's existence.</p>

<p>...</p>

<p>One day, as the guy was now in college and busy with his new routine, he came across some news: she had just cleared her 10th board exams and, to no surprise, had topped the state. Impressed but not entirely sure why he felt compelled to, he decided to congratulate her.</p>

<p>Opening Instagram, he found her profile and sent her a follow request. When she accepted, he quickly typed out a message. But being as clueless as he often was, he couldn't spell "congratulations." Instead, he settled for the simplest version he could manage: "Congrats." It was short, casual, and maybe even a little awkward, but it was the best he could do.</p>

<p>Back in school, she hated our senior batch. Honestly, I don't know why, but in her eyes, we were just another group of loud, reckless, and annoying teenagers. We'd often pull pranks, and there was always this chaotic energy around us that probably grated on her nerves. She avoided talking to anyone from our batch as much as possible. To her, we were nothing but a source of frustration. The whole batch was a blur of teasing and childish antics, and she wasn't interested in being part of that at all.</p>

<p>After sending his simple "Congrats," the conversation began slowly. He asked her how she was doing and where she was now, making sure to keep the questions casual. She replied politely, but her tone remained formal and courteous, as if she was still maintaining that boundary between them.</p>

<p>...</p>

<p>Then one day, during one of these conversations, he learned that she had been watching <em>The Vampire Diaries</em>. This caught his attention immediately he had watched it a while ago. Intrigued by their shared interest, he messaged her, asking what she thought of the show so far, curious about her opinions.</p>

<p>From there, their conversation naturally evolved. They began sharing more reels and memes related to the show, reacting to them and giving their opinions. It wasn't long before they were exchanging messages about other movies and series too. He was surprised by how much they had in common in terms of taste films, TV shows, even genres they both liked. It felt less like a senior-junior dynamic and more like two people genuinely enjoying each other's company.</p>

<p>One day, as their texting continued, it began to shift. What started as casual banter and meme exchanges slowly turned flirty. The playful tone in his messages seemed to carry a new, subtle layer of teasing, and he found himself enjoying the lighthearted back-and-forth.</p>

<p>After a while, feeling somewhat inspired, he wrote a poem in Hindi a poem spoken by a character in a show. The words were poetic, but there was no deep meaning behind them, just an attempt to keep their interaction playful. To his surprise, she seemed to appreciate it, and soon after, her feelings for him began to develop.</p>

<p>For him, though, it was all just part of the fun. He was still just texting, keeping it casual, without thinking too much about it. But she, slowly and unknowingly, was beginning to get attached. One day, she sent him a poem of her own, a beautiful one, no less. In it, she referenced the silly, sometimes dumb activities he had done back in school little moments she had noticed but he hadn't realized. The poem caught him off guard, and he started to sense that she might be developing feelings for him.</p>

<p>Frightened by the idea of someone actually liking him, he immediately tried to shut it down. The truth was, he had never really had feelings for anyone. He was phobic of them afraid of intimacy and emotions. He had always kept people at a distance, especially after flirting, because he preferred to avoid any emotional connections. So, he shifted back to sending memes and lighthearted messages, trying to keep the vibe casual and carefree.</p>

<p>...</p>

<p>Then, something unexpected happened. The man who had always been phobic of feelings, who had spent his life avoiding emotional attachments, found himself falling for her. It was completely surprising, something he never anticipated. In a way, she had broken through the walls he had so carefully built around himself, and before he knew it, he was in love.</p>

<p><strong>Hehe, all the stuff I wrote about is about me. Here, 'he' refers to me !!!!!</strong></p>
</p>`,
       "From Fear To Feelings": `<p><p>In "The First Chapter of Us", I recount my journey as a reserved and emotionally distant young man navigating the complexities of life, relationships, and self-discovery. Growing up, I avoided emotional connections and kept people at arm's length, but my world took an unexpected turn when a chance encounter with a junior girl sparked an unlikely bond.</p>

<p>What started as casual conversations and playful banter evolved into a meaningful connection, challenging my deep-rooted fears of attachment. Through shared interests, humor, and countless late-night talks, I began to see her in a new light. She unknowingly broke down the walls I had built, and for the first time, I found myself experiencing something I never thought possible, love.</p>

<p>This heartfelt tale captures my journey of growth, vulnerability, and transformation, as I learned to confront my fears and embrace emotions I had always kept at bay. It's a testament to the power of unexpected connections and how love can change even the most guarded hearts.</p>

<p>After all this, now I realize how far we've come. She was once my junior, someone I casually knew and interacted with a fleeting part of my life I never gave much thought to. But life had bigger plans for us. Over time, she became more than just someone I knew. She became my closest friend, my confidante, and eventually, my girlfriend.</p>

<p>There was a time when I built walls around myself, walls made of fear, insecurity, and uncertainty. I never imagined that someone could break through them, not just because of my hesitation to let anyone in, but because I truly believed I was better off alone. Love seemed like a foreign concept, something too overwhelming, something I couldn't handle. But as time passed, she slowly and unknowingly chipped away at the walls, piece by piece, until I found myself exposed, vulnerable, and more alive than I had ever felt.</p>

<p>I used to laugh it off, keep my emotions at bay, thinking they were distractions. I told myself that being emotionally distant was safer. But when I saw her laugh, or when I listened to her voice as she spoke about something she was passionate about, I couldn't help but feel something stirring inside me. It was more than just attraction, it was an awakening. And despite every instinct in me that wanted to push it away, I couldn't ignore it any longer.</p>

<p>What was it about her? Maybe it was the way her eyes lit up when she talked about her dreams, or the way she made me feel like I wasn't as lost as I thought. Maybe it was how she listened, really listened, like she understood things that even I hadn't yet figured out about myself. For the first time, I didn't feel like I had to protect myself from the world. She made me believe that it was okay to be soft, to care deeply, to let my guard down without fear of getting hurt.</p>

<p>She was so perfect. And I wasn't perfect. But together, we were something entirely new, something worth exploring. With every conversation, with every laugh, with every shared moment, the distance between us shrank. The person I had once been, the boy who feared love and avoided intimacy, was slowly fading away, replaced by someone willing to open his heart. For her.</p>

<p>I used to think love was something I wasn't made for, that it was something only other people deserved. But here I was, feeling it in ways I couldn't explain. I feared it at first, because love, for me, was synonymous with vulnerability, and I was terrified of being vulnerable. But as I let her in, I discovered that vulnerability wasn't a weakness, it was a strength. It was in letting her see the real me, the parts I had hidden away for so long, that I finally felt seen, understood, and loved in return.</p>

<p>In those quiet moments, when we would talk about nothing and everything at once, I began to realize that love wasn't just about grand gestures or perfect timing. It was about the small things the way she smiled when I sent her a silly meme, or how she remembered the little things I mentioned in passing. It was in the laughter we shared, the comfort we found in each other's presence, and the trust we built, one message at a time.</p>

<p>Now, looking back, I can see that I was never alone. I had been afraid of opening up to her, afraid of what might happen if I let myself feel too much. But with each conversation, with each shared moment, I began to understand that love wasn't something to fear. She loved me in a way that was gentle yet powerful, offering me warmth and understanding when I needed it most. Her presence made me feel safe, and with her, I learned that love didn't have to be a battle, it could simply be a quiet, beautiful force that changed everything.</p>

<p>And for the first time in my life, I can honestly say that I'm not afraid anymore. I'm not afraid of love. I'm not afraid of being vulnerable. Because with her by my side, I know that I can face anything. Together, we're stronger than anything I ever feared before. And for the first time, I understand that love isn't something to be afraid of. It's something to embrace.</p>

<p>She is the one who supports me through every challenge, even when I don't always share every detail of what I'm going through. I may not tell her everything that weighs on me, but somehow, she knows. She can sense when something's off, when I'm struggling, and without a word, she'll be there, offering her support in the quietest but most meaningful ways. Her understanding doesn't need to be asked for, it's just there, always.</p>

<p>She listens without judgment, giving me the space I need when I can't find the words to express what's on my mind. Her belief in me never wavers, even when I don't believe in myself. She's there with a steady hand to help me find my footing again. Her presence alone is a reminder that I'm not walking through life alone, and for that, I'm endlessly grateful.</p>

<p>Her love for me is unwavering, a love built on respect, loyalty, and trust. She holds my heart with a tenderness that I never knew I deserved, and in return, I give her my complete trust. She doesn't just care for me physically but emotionally as well, always ensuring I feel seen, heard, and understood.</p>

<p>She's my greatest supporter, always encouraging me to be the best version of myself, even when I doubt my own potential. Her support is a quiet strength, not loud or demanding, but always there, like an anchor keeping me grounded.</p>

<p>She cares for me in ways I never knew I needed, comforting me when I'm anxious, calming my fears when they threaten to overwhelm me. Her kindness is boundless, and her compassion is the reason my heart feels at ease, knowing that I have her beside me through it all.</p>

<p>Her beauty is not just skin deep, it radiates from within. She's stunning in every sense her smile, her eyes, her warmth but it's her heart that makes her truly beautiful. She has a way of making the world feel a little brighter, just by being herself. Her soul is pure, and that purity shows in everything she does, in the love she gives and the way she cares for those around her.</p>

<p>In her, I found a love that is not conditional or fleeting. It's a love that has grown with every passing day, one that fills my heart and soul with a warmth I never expected to feel. She loves me for who I am, the good and the bad, and in her eyes, I've found a sense of worth I never thought I could have.</p>

<p>She's not just a part of my life now, she's the very center of it. One day, she'll be my wife, the woman I vow to spend my life with. In the future, she'll be the incredible mother of my kids, and together, we'll build a beautiful life. She loves me with all her heart, admires me in ways no one ever has, and cares for me in ways I never thought I deserved.</p>

<p>What more could I possibly ask for in this lifetime? She's not just my partner, she's my safe space, my biggest supporter, and the most beautiful soul I've ever met. She's so perfect for someone like me, a person who often feels undeserving of her love. And yet, she chooses me, every single day.</p>

<p>I love her more than words could ever express.</p>

<p>And here she refers to my lucky charm, my mumma's daughter-in-law, my love Riddhima. I really love you.</p>
`,
       "A Forever Unwritten": `<p>This one is about how I dream of loving you forever. Looking back, I see how every fear, every hesitation, and every moment of uncertainty led us to something so rare, so beautiful. I see how we turned doubts into trust, distance into closeness, and feelings into something deeper, something words will always fall short of describing.</p>
       <p> We weren't just two people who met, we were two souls meant to intertwine. Every late-night conversation, every whispered confession, and even the quiet moments where we didn't need words to understand each other weren't just fleeting instances. They were the foundation of forever.</p>

<p>I can't stand seeing even a single tear in your eyes. You know that, don't you? Our love isn't just built on grand gestures but in the small, playful moments too, the ones where you tease me, prank me, and make me react. And I admit, sometimes I take your jokes too seriously, letting them sink in before realizing it was all in good fun. I wish I could tease you the same way, but I always hold back, not because I don't want to, but because I know how tender your heart is, and I never want to be the reason it aches.</p>
<p> I might joke about pranking you or being harsh, but deep down, I could never bring myself to do it. That's why the fiery, mischievous energy in our relationship comes from you, my "kaleshi aurat," "my pasandida aurat," my one and only. You bring the spark, the fire, the excitement, and I? I want to be your calm, your safety, your forever.</p>

<p>I don't want to just look back on how we got here‚Äîit was deeply memorable and filled with love because, without a doubt, it was always God's plan, it was a beautiful memory of us, one I never want to forget. Every twist, every turn, every moment that led us here was meant to be, shaping a story that was written long before we even knew it. But now, I want to look forward, to everything that's still ahead. I see a future where love isn't just a feeling, but a constant, where "us" isn't just a chapter, but an entire lifetime. I see us laughing over the silliest things, arguing over where to eat but never over how much we love each other. I see us holding hands on the hardest days, reminding each other that no matter what, we are never alone. I see us celebrating every little victory, from the biggest milestones to the tiniest moments that only we would understand. I see Sunday mornings where you steal the blanket, and I let you because, at the end of the day, it's just another excuse to pull you closer. I see late nights where we can't decide on a movie, only to end up watching something neither of us planned but both of us enjoy. I see us getting lost in endless conversations, making big plans for the future, knowing that even if life doesn't go exactly as planned, as long as we're together, we'll always find our way.</p>

<p>I can't predict the future. I can't promise that life will always be smooth or that there won't be challenges along the way. But what I can promise is that no matter what happens, I will always choose you. In every version of tomorrow, in every reality, you will always be my favorite part. In every unwritten page of my life, you will be my most beautiful story. And in every lifetime, if I am given the choice, I will find you and love you all over again. Because some love stories have endings, b
>`
    };

    class Page {
        constructor(chapter = "", title = "", isFirstOfChapter = false) {
            this.element = document.createElement("div");
            this.element.classList.add("page");
            this.element.dataset.chapter = chapter;
            this.element.style.display = "none";
            book.appendChild(this.element);

            this.previous = null;
            this.next = null;

            if (!firstPage) firstPage = this;
            if (lastPage) {
                lastPage.next = this;
                this.previous = lastPage;
            }
            lastPage = this;

            if (isFirstOfChapter) {
                const chapterTitle = document.createElement("h2");
                chapterTitle.innerText = title;
                this.element.appendChild(chapterTitle);
            }

            this.textContainer = document.createElement("div");
            this.element.appendChild(this.textContainer);
        }

        addText(content) {
            this.textContainer.innerHTML = content;
        }
    }
    
    // Cover Page
    const coverPage = new Page("cover");
    coverPage.addText(`<img src="./assets/cover.jpg" alt="Book Cover" class="cover-img"><h2></h2>`);
    // Index Page
    const indexPage = new Page("Chapters Of US");
    indexPage.addText(`
        <h2 class="chapter-title">Chapters Of US</h2>
        <div class="menu">
            <div class="menu-item" data-chapter="Before You Begin">Before You Begin</div>
            <div class="menu-item" data-chapter="The First Chapter Of US">The First Chapter Of US</div>
            <div class="menu-item" data-chapter="From Fear To Feelings">From Fear To Feelings</div>
            <div class="menu-item" data-chapter="A Forever Unwritten">A Forever Unwritten</div>
        </div>

    `); 

    // Before You Begin
    const overviewPage = new Page("#Before You Begin"); //
    overviewPage.addText(`
    <h2>Before You Begin</h2>
    <p>This isn‚Äôt really a book, and I‚Äôm not a writer. But this is our story the way I remember it, the way it felt, and the way it still lives in my heart. I‚Äôve tried to capture every little moment, from how it all began to everything that led us here. You know my memory isn‚Äôt the best, but I‚Äôve written down as much as I could recall. Maybe I missed some details, but what matters most is that every word comes straight from me to you. I hope you‚Äôll like it...</p>
`);


    // Create Pages for Each Chapter
    Object.keys(chapterData).forEach(chapter => {
        let paragraphs = chapterData[chapter].split("</p>").map(p => p + "</p>").filter(p => p.trim() !== "</p>");
        let tempPage = new Page(chapter, ` ${chapter.replace("chapter", "Chapter ")}`, true);
        let tempText = "";

        const testPage = document.createElement("div");
        testPage.classList.add("page", "hidden-page");
        book.appendChild(testPage);

        paragraphs.forEach(paragraph => {
            tempText += paragraph;
            testPage.innerHTML = tempText;

            if (testPage.scrollHeight > testPage.clientHeight) {
                tempText = paragraph;
                tempPage = new Page(chapter, "", false);
            }

            tempPage.addText(tempText);
        });

        book.removeChild(testPage);
    });

    // Set Initial Page
    currentPage = firstPage;
    currentPage.element.style.display = "block";

    // Keyboard Navigation
    document.addEventListener("keydown", (event) => {
        if (event.key === "ArrowRight" && currentPage.next) {
            currentPage.element.style.display = "none";
            currentPage = currentPage.next;
            currentPage.element.style.display = "block";
        } else if (event.key === "ArrowLeft" && currentPage.previous) {
            currentPage.element.style.display = "none";
            currentPage = currentPage.previous;
            currentPage.element.style.display = "block";
        }
    });

    // Mobile Swipe Navigation
    book.addEventListener("touchstart", (event) => {
        startX = event.touches[0].clientX;
    });

    book.addEventListener("touchend", (event) => {
        let endX = event.changedTouches[0].clientX;
        if (startX - endX > 50 && currentPage.next) {
            currentPage.element.style.display = "none";
            currentPage = currentPage.next;
            currentPage.element.style.display = "block";
        } else if (endX - startX > 50 && currentPage.previous) {
            currentPage.element.style.display = "none";
            currentPage = currentPage.previous;
            currentPage.element.style.display = "block";
        }
    });
     // **Jump to Specific Chapter from Menu**
     document.querySelectorAll(".menu-item").forEach(item => {
        item.addEventListener("click", () => {
            let targetChapter = item.dataset.chapter;
            let targetPage = firstPage;

            while (targetPage) {
                if (targetPage.element.dataset.chapter === targetChapter) {
                    break;
                }
                targetPage = targetPage.next;
            }

            if (targetPage) {
                currentPage.element.style.display = "none";
                currentPage = targetPage;
                currentPage.element.style.display = "block";
            }
        });
    });
});
 

document.addEventListener("DOMContentLoaded", function () {
    const pages = document.querySelectorAll(".page");

    pages.forEach((page, index) => {
        if (index !== 0) {  // Skip the first page (cover)
            page.setAttribute("data-page", index);
        }
    });
});

if (isFirstOfChapter) {
    const chapterTitle = document.createElement("h2");
    chapterTitle.innerText = title;
    chapterTitle.classList.add("chapter-heading");  // Apply the class
    this.element.appendChild(chapterTitle);
}
let tempPage = new Page(chapter, `üìñ ${chapter.replace("chapter", "Chapter ")}`, true);

//page no
document.addEventListener("DOMContentLoaded", function () {
    const pages = document.querySelectorAll(".page");

    pages.forEach((page, index) => {
        if (index !== 0) {  // Skip the first page (cover)
            page.setAttribute("data-page", index);
        }
    });
});
document.addEventListener("DOMContentLoaded", function () {
    // Select all text-containing elements inside the book
    let bookPages = document.querySelectorAll("#book p, #book h2, #book h3, #book span, #book div");

    bookPages.forEach((element) => {
        element.innerHTML = element.innerHTML.replace(/‚Äô/g, "'"); // Replace curly apostrophes with straight ones
    });
});
